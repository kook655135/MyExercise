{
    // VS Code 側邊欄顯示的名稱
    "name": "Demo Python Project with Poetry", 

    "dockerComposeFile": [
        "docker-compose.yml"
    ],
    "service": "app",
    "workspaceFolder": "/app",
    "forwardPorts": [8080], 

    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.python",
                "ms-python.black-formatter", 
                "ms-python.isort",
                "streetsidesoftware.code-spell-checker",
                "eamodio.gitlens",
                "shardulm94.trailing-spaces",
                "vivaxy.vscode-conventional-commits",
                "bierner.markdown-mermaid",
                "bungcip.better-toml",
                "mechatroner.rainbow-csv",
            ],
            
            "settings": {
                // 終端機設定
                "terminal.integrated.defaultProfile.linux": "zsh",
                
                // 程式碼風格設定
                "editor.defaultFormatter": "ms-python.black-formatter",
                "editor.tabSize": 4,
                "editor.rulers": [100],
                
                // *** Poetry 整合與 Python 解釋器設定 (關鍵部分) ***
                "python.defaultInterpreterPath": "/usr/local/bin/python", 
                "python.languageServer": "Pylance",
                "python.testing.pytestEnabled": true,
                
                // 告訴 Pylance 尋找 Poetry 建立的虛擬環境
                "python.analysis.extraPaths": [
                "${workspaceFolder}/.venv/lib/python3.12/site-packages"
                ]
            }
        }
    },
    
    // 容器創建後執行的指令 (使用 Array 語法，確保 Shell 執行穩定)
    "postCreateCommand": [
       "sh", 
       "./.devcontainer/postCreateCommand.sh"
    ],
    
    // 使用 -D (Daemon) 模式啟動，更穩定且自動管理背景執行
    // "postStartCommand": "bash -c 'mkdir -p /app/airflow && cd /app && /root/.local/bin/poetry run airflow webserver -D && /root/.local/bin/poetry run airflow scheduler -D'",

    // 使用 Daemon (-D) 模式啟動，並直接指定 DAG 資料夾
    "postStartCommand": "bash -c 'export AIRFLOW__CORE__LOAD_EXAMPLES=False && export AIRFLOW__CORE__DAGS_FOLDER=/app/dags && mkdir -p /app/airflow && cd /app && /root/.local/bin/poetry run airflow webserver -D && /root/.local/bin/poetry run airflow scheduler -D'",

    "remoteUser": "root" 
}